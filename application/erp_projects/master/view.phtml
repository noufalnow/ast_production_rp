<div class="main-container container">

	<div class="page-header" style="margin-bottom:0.5rem;margin-top:0.5rem;">
		<div>
			<h1 class="page-title">
				<?=$this->propertyDetail['project_code']?> /
				<?=$this->propertyDetail['cust_name']?> /
				<?=$this->propertyDetail['project_name']?>
			</h1>
		</div>
		<div class="ms-auto pageheader-btn">
			<?=x([
				'link'=>'erp_projects/master/list',
				'label'=>'<button class="btn btn-info pull-right" style="margin-bottom:10px;margin-right:1em;">Back</button>'
			])?>
		</div>
	</div>

	<div class="row row-sm">
		<div class="col-xxl-4 col-xl-12">
			<div class="card custom-card">
				<div class="card-body">

					<!-- TABS -->
					<div class="col-12">
						<ul class="nav nav-tabs tab-style-1 d-sm-flex d-block" role="tablist">
							<li class="nav-item">
								<a class="nav-link active"
								   data-bs-toggle="tab"
								   data-bs-target="#Summary"
								   href="#Summary"
								   role="tab">
									Summary
								</a>
							</li>

							<li class="nav-item">
								<?=accx(
									'erp_projects/master/propdocs',
									'<a class="nav-link ' . @$this->doc_class . '"
										data-bs-toggle="tab"
										href="#menu2"
										data-bs-target="#menu2"
										onclick="getContent(\'' . APPURL . 'erp_projects/master/propdocs\',\'' . $this->param['ref'] . '\',\'menu2\')"
										role="tab">
										Documents
									</a>'
								);?>
							</li>

						</ul>
					</div>

					<!-- TAB CONTENT (IMPORTANT FIX) -->
					<div class="tab-content mb-3">

						<!-- SUMMARY TAB -->
						<div class="tab-pane fade show active" id="Summary" role="tabpanel">

							<table class="table table-bordered" style="max-width:65%; float:left;">
								<tr><th>Project Code</th><td><?=$this->propertyDetail['project_code']?></td></tr>
								<tr><th>Project Name</th><td><?=$this->propertyDetail['project_name']?></td></tr>
								<tr><th>Customer</th><td><?=$this->propertyDetail['cust_name']?></td></tr>
								<tr><th>Category</th><td><?=$this->projectCategory[$this->propertyDetail['project_category']]?></td></tr>
								<tr><th>Type</th><td><?=$this->projectType[$this->propertyDetail['project_type']]?></td></tr>
								<tr><th>Sector</th><td><?=$this->projectSector[$this->propertyDetail['project_sector']]?></td></tr>
								<tr><th>Contract Mode</th><td><?=$this->projectContractMode[$this->propertyDetail['project_contract_mode']]?></td></tr>
								<tr><th>Budget</th><td><?=number_format($this->propertyDetail['project_budget'],3)?></td></tr>
								<tr><th>Duration (Months)</th><td><?=$this->propertyDetail['project_duration_months']?></td></tr>
								<tr><th>Status</th><td><?=$this->propertyDetail['project_status_label']?></td></tr>
								<tr><th>File No</th><td><?=$this->propertyDetail['project_fileno']?></td></tr>
								<tr><th>Remarks</th><td><?=$this->propertyDetail['project_remarks']?></td></tr>
							</table>

							<table style="max-width:40%; float:right;">
								<tr>
									<td class="text-center">
										<a href="<?=IMAGEURL?><?=$this->encode($this->propImage['file_id']);?>" class="lightbox">
											<img width="380"
												 src="<?=IMAGEURL?><?=$this->encode($this->propImage['file_id']);?>">
										</a>
									</td>
								</tr>
							</table>

							<div style="display: table; width: 100%;">
	<label><h2>Project Documents & Contracts</h2></label>

	<table class="table table-bordered">
		<thead>
			<tr>
				<th width="8%" class="center">Document Type</th>
				<th width="5%" class="center">Contract / Doc No</th>
				<th width="8%" class="center">Advance / Stage Amount</th>
				<th width="8%" class="center">Contract Value</th>
				<th width="8%" class="center">Contract Start</th>
				<th width="4%" class="center">Contract End</th>
				<th width="4%" class="center">Payment / Milestone Details</th>
				<th width="5%" class="center">View</th>
				<th width="5%" class="center">Edit</th>
				<th width="5%" class="center">Download</th>
			</tr>
		</thead>

		<tbody>
		<?php
		foreach ($this->propDocs as $doc):
			$doi = DateTime::createFromFormat(DFS_DB,$doc['doc_issue_date'])->format(DF_DD);
			$doe = DateTime::createFromFormat(DFS_DB,$doc['doc_expiry_date'])->format(DF_DD);
			$encFileId = $this->encode($doc['file_id']);
			$encDocId  = $this->encode($doc['doc_id']);
		?>
			<tr>
				<td>
					<?=x([
						'link'=>'erp_projects/master/propdocsview',
						'ref'=>$encDocId,
						'label'=>$this->docMst[$doc['doc_type']],
						['param'=>'class="facebox"']
					])?>
				</td>

				<td><?=$doc['doc_no']?></td>
				<td class="center"><?=$doc['agr_rent']?></td>
				<td class="center"><?=$doc['agr_amount']?></td>
				<td class="center"><?=$doi?></td>
				<td class="center"><?=$doe?></td>
				<td class="center"><?=$doc['agr_paydet']?></td>



				<td class="center">
					<?=x([
						'link'=>'default/default/download',
						'ref'=>$encFileId,
						'label'=>'<i class="fas fa-search"></i>',
						['exten'=>$doc['file_exten']]
					])?>
				</td>


					<td class="center">
						<?=x([
							'link'=>'erp_projects/master/propdocsedit',
							'ref'=>$encDocId,
							'label'=>'<i class="fas fa-edit"></i>',
							['param'=>'class="facebox"']
						])?>
					</td>


				<td class="center">
					<?=x([
						'link'=>'default/default/download',
						'ref'=>$encFileId,
						'label'=>'<i class="glyphicon glyphicon-download-alt text-info"></i>',
						['param'=>'opener']
					])?>
				</td>
			</tr>
		<?php endforeach;?>
		</tbody>
	</table>
</div>
							
						</div>

						<!-- DOCUMENTS TAB (AJAX TARGET) -->
						<div class="tab-pane fade" id="menu2" role="tabpanel"></div>

						<!-- PROFILE TAB (AJAX TARGET) -->
						<div class="tab-pane fade" id="menu3" role="tabpanel"></div>

					</div><!-- /tab-content -->

				</div><!-- /card-body -->
	
	




<?php 
$COMMDOCTYPE= DOC_TYPE_COM_PROJECT; $COMMDOCREFID= $this->decPropId;
$UPDTYPE = UPD_TYP_PROJECT; $UPDREFID = $this->decPropId;
if($this->propertyDetail['prop_building_type']==1){
    viewAction(array('module'=>'erp_manage', 'controller'=>'documents', 'action'=>'documents', 'param'=>array('type'=>$COMMDOCTYPE,'ref'=>$COMMDOCREFID)));
}
viewAction(array('module'=>'erp_manage', 'controller'=>'updates', 'action'=>'updates', 'param'=>array('type'=>$UPDTYPE,'ref'=>$UPDREFID)));
?>
</div></div>		</div><!-- /card -->
		</div>

<script type="text/javascript">           
/*$(document).ready(function() {
	$('#show_action').on('click',function() {
		if($('#action_target').is(":visible"))
			$('#action_target').hide();
		else
			$('#action_target').show();
	});
	$('#photo_action').on('click',function() {
		if($('#photo_target').is(":visible"))
			$('#photo_target').hide();
		else
			$('#photo_target').show();
	});
});
*/
function toggleAction(){
	if($('#action_target').is(":visible"))
		$('#action_target').hide();
	else
		$('#action_target').show();
}
function togglePhoto(){
	if($('#photo_target').is(":visible"))
		$('#photo_target').hide();
	else
		$('#photo_target').show();
}

</script>